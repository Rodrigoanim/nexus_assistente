================================================================================
DOCUMENTA√á√ÉO DE ALTERA√á√ÉO - INSER√á√ÉO DE BOT√ïES DO MENU NO FINAL DA P√ÅGINA
================================================================================

Data: 07/11/2025
Assessment: DISC Essencial (assessment "01")
Arquivos Modificados: main.py e paginas/form_model_01.py

================================================================================
OBJETIVO
================================================================================

Adicionar os mesmos bot√µes do menu principal (Parte 1, Parte 2, Resultados) 
no final da p√°gina renderizada, permitindo que o usu√°rio mude de se√ß√£o sem 
precisar fazer scroll at√© o topo da p√°gina.

================================================================================
ARQUIVOS MODIFICADOS
================================================================================

1. main.py
   - Fun√ß√£o: show_assessment_execution()
   - Localiza√ß√£o: Linha ~906 (se√ß√£o do assessment "01")

2. paginas/form_model_01.py
   - Fun√ß√£o: process_forms_tab_01()
   - Localiza√ß√£o: Linha ~938 (ap√≥s st.divider())

================================================================================
ALTERA√á√ïES NO main.py
================================================================================

1. ADICIONAR CALLBACK NO MENU PRINCIPAL
   - Criar fun√ß√£o callback on_main_menu_change() antes do st.radio
   - Adicionar par√¢metro on_change=on_main_menu_change no st.radio

2. VERIFICAR target_section_01 ANTES DE CRIAR O WIDGET
   - Verificar se h√° target_section_01 no session_state
   - Se houver, atualizar o session_state do menu principal ANTES de criar o widget
   - Limpar a vari√°vel auxiliar ap√≥s usar

3. PROCESSAR SE√á√ÉO CORRETA
   - Prioridade 1: Se h√° target_section_01, processar ela
   - Prioridade 2: Se n√£o h√° target_section_01, processar a selecionada pelo menu principal

C√ìDIGO A ADICIONAR/ALTERAR:

# Fun√ß√£o callback para quando o menu principal mudar
def on_main_menu_change():
    """Callback chamado quando o menu principal muda"""
    selected = st.session_state["disc10_section_selector"]
    if selected:
        # Sincroniza com o menu do final da p√°gina
        st.session_state["disc10_section_selector_bottom"] = selected
        # Limpa a vari√°vel auxiliar do menu do final para evitar conflito
        if "target_section_XX" in st.session_state:  # XX = n√∫mero do assessment
            del st.session_state["target_section_XX"]

# Verifica se h√° uma se√ß√£o alvo definida pelo menu do final da p√°gina
target_section = st.session_state.get("target_section_XX", None)  # XX = n√∫mero do assessment
section_to_process = None

if target_section:
    section_to_process = target_section
    # Encontra a op√ß√£o correspondente √† se√ß√£o alvo
    target_option = None
    for option, value in section_options.items():
        if value == target_section:
            target_option = option
            break
    
    # Se encontrou, atualiza o session_state do menu principal ANTES de criar o widget
    if target_option:
        st.session_state["discXX_section_selector"] = target_option  # XX = n√∫mero do assessment
        # Limpa a vari√°vel auxiliar
        del st.session_state["target_section_XX"]

# Adicionar on_change no st.radio do menu principal
selected_section = st.radio(
    "IMPORTANTE: precisa responder tanto a Parte 1 quanto a Parte 2",
    options=list(section_options.keys()),
    key="discXX_section_selector",  # XX = n√∫mero do assessment
    horizontal=True,
    on_change=on_main_menu_change  # ADICIONAR ESTE PAR√ÇMETRO
)

# Executar a se√ß√£o selecionada
if not section_to_process and selected_section:
    section_to_process = section_options[selected_section]

if section_to_process:
    process_forms_tab(section_to_process)

================================================================================
ALTERA√á√ïES NO paginas/form_model_XX.py
================================================================================

1. ADICIONAR MENU NO FINAL DA P√ÅGINA
   - Ap√≥s st.divider() (final da fun√ß√£o process_forms_tab_XX)
   - Verificar se estamos no assessment correto
   - Criar os mesmos radio buttons do menu principal

2. CRIAR CALLBACK PARA O MENU DO FINAL
   - Fun√ß√£o on_bottom_menu_change() que atualiza target_section_XX
   - Adicionar on_change no st.radio do menu do final

3. SINCRONIZA√á√ÉO COM MENU PRINCIPAL
   - Usar session_state para sincronizar valores
   - Key diferente para evitar conflito (ex: discXX_section_selector_bottom)

C√ìDIGO A ADICIONAR (ap√≥s st.divider()):

# Separador
st.divider()

# Adiciona os mesmos bot√µes do menu no final da p√°gina para todas as se√ß√µes
# Verifica se estamos no assessment correto
assessment_id = st.session_state.get("selected_assessment_id", "")
if assessment_id == "XX":  # XX = n√∫mero do assessment (ex: "01", "02", "03")
    st.markdown("#### üìã Selecione a Parte que deseja")
    
    # Usar os mesmos radio buttons do menu (key diferente para evitar conflito)
    section_options = {
        "üéØ Parte 1": "perfil",  # Ajustar conforme o assessment
        "üìä Parte 2": "comportamento",  # Ajustar conforme o assessment
        "üìà Resultados": "resultado"  # Ajustar conforme o assessment
    }
    
    # Sincroniza com o valor do menu principal usando session_state
    main_menu_value = st.session_state.get("discXX_section_selector", None)  # XX = n√∫mero do assessment
    bottom_menu_value = st.session_state.get("discXX_section_selector_bottom", None)
    
    # Determina o √≠ndice inicial baseado no valor do menu principal ou na se√ß√£o atual
    current_option = None
    if main_menu_value:
        current_option = main_menu_value
    elif bottom_menu_value:
        current_option = bottom_menu_value
    else:
        for option, value in section_options.items():
            if value == section:
                current_option = option
                break
    
    # Se n√£o encontrou, usa a primeira op√ß√£o
    options_list = list(section_options.keys())
    initial_index = options_list.index(current_option) if current_option in options_list else 0
    
    # Fun√ß√£o callback para quando o menu do final da p√°gina mudar
    def on_bottom_menu_change():
        """Callback chamado quando o menu do final da p√°gina muda"""
        selected = st.session_state["discXX_section_selector_bottom"]  # XX = n√∫mero do assessment
        if selected:
            section_value = section_options[selected]
            # Atualiza a vari√°vel auxiliar que ser√° lida pelo main.py
            st.session_state["target_section_XX"] = section_value  # XX = n√∫mero do assessment
            # For√ßa rerun para que o main.py processe a mudan√ßa
            st.rerun()
    
    selected_section = st.radio(
        "IMPORTANTE: precisa responder tanto a Parte 1 quanto a Parte 2",
        options=options_list,
        key="discXX_section_selector_bottom",  # Key diferente para evitar conflito
        horizontal=True,
        index=initial_index,
        on_change=on_bottom_menu_change  # Callback quando mudar
    )

================================================================================
PONTOS IMPORTANTES PARA ADAPTAR NOS OUTROS ASSESSMENTS
================================================================================

1. SUBSTITUIR "XX" PELO N√öMERO DO ASSESSMENT:
   - "01" = DISC Essencial
   - "02" = DISC 20
   - "03" = √Çncoras de Carreira
   - "04" = Armadilhas do Empres√°rio
   - "05" = Anamnese Completa

2. AJUSTAR section_options CONFORME O ASSESSMENT:
   - Verificar no main.py quais s√£o as op√ß√µes e valores corretos
   - Exemplo para assessment "03":
     section_options = {
         "üéØ Parte 1": "ancoras_p1",
         "üìä Parte 2": "ancoras_p2", 
         "üìà Resultados": "resultado"
     }

3. AJUSTAR KEYS DO session_state:
   - discXX_section_selector (menu principal)
   - discXX_section_selector_bottom (menu do final)
   - target_section_XX (vari√°vel auxiliar)

4. VERIFICAR O assessment_id NO main.py:
   - Cada assessment tem seu pr√≥prio bloco if/elif
   - Adicionar o c√≥digo no bloco correto

================================================================================
EXEMPLO DE ADAPTA√á√ÉO PARA ASSESSMENT "02" (DISC 20)
================================================================================

main.py (dentro do bloco elif assessment_id == "02"):

# Fun√ß√£o callback para quando o menu principal mudar
def on_main_menu_change():
    """Callback chamado quando o menu principal muda"""
    selected = st.session_state["disc20_section_selector"]
    if selected:
        st.session_state["disc20_section_selector_bottom"] = selected
        if "target_section_02" in st.session_state:
            del st.session_state["target_section_02"]

target_section = st.session_state.get("target_section_02", None)
section_to_process = None

if target_section:
    section_to_process = target_section
    target_option = None
    for option, value in section_options.items():
        if value == target_section:
            target_option = option
            break
    if target_option:
        st.session_state["disc20_section_selector"] = target_option
        del st.session_state["target_section_02"]

selected_section = st.radio(
    "Escolha a se√ß√£o:",
    options=list(section_options.keys()),
    key="disc20_section_selector",
    horizontal=True,
    on_change=on_main_menu_change  # ADICIONAR
)

paginas/form_model_02.py (ap√≥s st.divider()):

assessment_id = st.session_state.get("selected_assessment_id", "")
if assessment_id == "02":
    st.markdown("#### üìã Selecione a se√ß√£o que deseja responder")
    
    section_options = {
        "üéØ Parte 1": "perfil",
        "üìä Parte 2": "comportamento", 
        "üìà Resultados": "resultado"
    }
    
    main_menu_value = st.session_state.get("disc20_section_selector", None)
    bottom_menu_value = st.session_state.get("disc20_section_selector_bottom", None)
    
    current_option = None
    if main_menu_value:
        current_option = main_menu_value
    elif bottom_menu_value:
        current_option = bottom_menu_value
    else:
        for option, value in section_options.items():
            if value == section:
                current_option = option
                break
    
    options_list = list(section_options.keys())
    initial_index = options_list.index(current_option) if current_option in options_list else 0
    
    def on_bottom_menu_change():
        selected = st.session_state["disc20_section_selector_bottom"]
        if selected:
            section_value = section_options[selected]
            st.session_state["target_section_02"] = section_value
            st.rerun()
    
    selected_section = st.radio(
        "Escolha a se√ß√£o:",
        options=options_list,
        key="disc20_section_selector_bottom",
        horizontal=True,
        index=initial_index,
        on_change=on_bottom_menu_change
    )

================================================================================
TESTES REALIZADOS
================================================================================

‚úÖ Menu do final da p√°gina aparece em todas as se√ß√µes (Parte 1, Parte 2, Resultados)
‚úÖ Bot√µes do menu principal funcionam corretamente
‚úÖ Bot√µes do menu do final funcionam corretamente
‚úÖ Sincroniza√ß√£o bidirecional entre os menus funciona
‚úÖ N√£o h√° conflito de keys entre os menus
‚úÖ Callbacks funcionam corretamente

================================================================================
OBSERVA√á√ïES IMPORTANTES
================================================================================

1. A key do menu do final DEVE ser diferente da key do menu principal
   - Menu principal: "discXX_section_selector"
   - Menu do final: "discXX_section_selector_bottom"

2. A vari√°vel auxiliar target_section_XX √© limpa ap√≥s uso para evitar conflitos

3. Os callbacks s√£o executados ANTES do rerun, garantindo sincroniza√ß√£o

4. O menu do final aparece em TODAS as se√ß√µes, n√£o apenas nas Partes 1 e 2

5. O √≠ndice inicial do menu do final √© calculado baseado na se√ß√£o atual ou 
   no valor do menu principal para manter sincroniza√ß√£o

================================================================================
FIM DA DOCUMENTA√á√ÉO
================================================================================

